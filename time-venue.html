<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TechUtsav 2025 | Event Schedule</title>
  <link rel="icon" href="static/favicon.png" type="image/png">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    html, body {
      height: 100%;
    }
    body {
      display: flex;
      flex-direction: column;
      position: relative;
      overflow-x: hidden;
    }
    main {
      flex: 1;
      position: relative;
      z-index: 10;
    }
    header, nav, footer {
      position: relative;
      z-index: 10;
    }
    /* Background Video */
    .background-video {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
      pointer-events: none; /* Allow clicks through video */
    }
  </style>
</head>
<body class="bg-gray-100 font-sans min-h-screen flex flex-col">

  <!-- Background Video -->
  <video autoplay muted loop class="background-video">
    <source src="static/bg-video.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <!-- Header -->
  <header class="bg-blue-700 text-white shadow-md flex flex-col sm:flex-row items-center justify-start px-6 py-4">
    <img src="static/Centurion_University_Logo.png" alt="CUTM Logo" class="h-16 sm:mr-4 mb-2 sm:mb-0">
    <div class="text-center sm:text-left">
      <h1 class="text-3xl font-bold">TechUtsav 2025</h1>
      <p class="mt-1 text-lg">Event Schedule | 24th & 25th October</p>
    </div>
  </header>

  <!-- Navbar -->
  <nav class="bg-white shadow-md px-6 py-3 flex justify-end space-x-4" id="navbar"></nav>

  <!-- Event Schedule Table -->
  <main class="flex-1 max-w-6xl mx-auto p-6">
    <h2 class="text-2xl font-bold mb-4 text-center">TechUtsav 2025 Event Schedule</h2>
    <div class="overflow-x-auto">
      <table id="scheduleTable" class="min-w-full bg-white rounded-lg shadow-md hidden table-fixed">
  <thead class="bg-blue-700 text-white">
    <tr>
      <th class="py-2 px-4 text-left w-1/12">Day</th>
      <th class="py-2 px-4 text-left w-3/12">Event Name</th>
      <th class="py-2 px-4 text-left w-2/12">Date</th>
      <th class="py-2 px-4 text-left w-2/12">Starting Time</th>
      <th class="py-2 px-4 text-left w-4/12">Venue (Tentative)</th>
    </tr>
  </thead>
  <tbody class="text-gray-700" id="tableBody"></tbody>
</table>

    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white text-center py-4 mt-8">
    <p>&copy; 2025 Department of CSE, Centurion University | TechUtsav 2025</p>
  </footer>

  <!-- JS: Dynamic Navbar & Load Excel -->
  <script>
    // Dynamic Navbar
    const navbar = document.getElementById('navbar');
    const currentPage = window.location.pathname.split('/').pop();

    if(currentPage !== 'index.html' && currentPage !== '') {
      const homeLink = document.createElement('a');
      homeLink.href = 'index.html';
      homeLink.textContent = 'Home';
      homeLink.className = 'flex items-center text-blue-700 font-semibold hover:text-blue-900';
      navbar.appendChild(homeLink);
    }

    const navLinks = [
      { label: 'Event Schedule', href: 'event_schedule.html' },
      { label: 'Contact Team', href: 'contact-team.html' }
    ];
    navLinks.forEach(link => {
      if(link.href !== currentPage) {
        const a = document.createElement('a');
        a.href = link.href;
        a.textContent = link.label;
        a.className = 'flex items-center text-blue-700 font-semibold hover:text-blue-900';
        navbar.appendChild(a);
      }
    });

    // Convert Excel date (number) to DD-MM-YYYY
    function formatExcelDate(excelDate) {
      if (typeof excelDate === 'number') {
        const dateObj = XLSX.SSF.parse_date_code(excelDate);
        if (!dateObj) return excelDate;
        return `${String(dateObj.d).padStart(2,'0')}-${String(dateObj.m).padStart(2,'0')}-${dateObj.y}`;
      }
      return excelDate;
    }

    // Convert Excel time (fraction) to HH:MM
    function formatExcelTime(excelTime) {
      if (typeof excelTime === 'number') {
        const totalMinutes = Math.round(excelTime * 24 * 60);
        const hours = Math.floor(totalMinutes / 60);
        const minutes = totalMinutes % 60;
        return `${String(hours).padStart(2,'0')}:${String(minutes).padStart(2,'0')}`;
      }
      return excelTime;
    }

    async function loadExcel() {
      try {
        const response = await fetch('event_schedule.xlsx');
        const arrayBuffer = await response.arrayBuffer();
        const workbook = XLSX.read(arrayBuffer, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const data = XLSX.utils.sheet_to_json(sheet, { defval: "" });

        const tableBody = document.getElementById('tableBody');
        let lastDay = null;

        data.forEach(row => {
          if(Object.values(row).every(cell => cell === null || cell === undefined || cell === "")) return;

          const tr = document.createElement('tr');
          tr.classList.add('border-b','hover:bg-gray-100');

          const dayTd = document.createElement('td');
          dayTd.classList.add('py-2','px-4','font-semibold');
          if(row['Day'] && row['Day'] !== lastDay){
            dayTd.innerText = row['Day'];
            lastDay = row['Day'];
          } else {
            dayTd.innerText = "";
          }
          tr.appendChild(dayTd);

          const eventTd = document.createElement('td');
          eventTd.classList.add('py-2','px-4');
          eventTd.innerText = row['Event Name'];
          tr.appendChild(eventTd);

          const dateTd = document.createElement('td');
          dateTd.classList.add('py-2','px-4');
          dateTd.innerText = formatExcelDate(row['Date']);
          tr.appendChild(dateTd);

          const timeTd = document.createElement('td');
          timeTd.classList.add('py-2','px-4');
          timeTd.innerText = formatExcelTime(row['Starting Time']);
          tr.appendChild(timeTd);

          const venueTd = document.createElement('td');
          venueTd.classList.add('py-2','px-4');
          venueTd.innerHTML = row['Venue'].replace(/\n/g,"<br>");
          tr.appendChild(venueTd);

          tableBody.appendChild(tr);
        });

        document.getElementById('scheduleTable').classList.remove('hidden');
      } catch (err) {
        console.error("Failed to load Excel file:", err);
        alert("Could not load event_schedule.xlsx. Make sure the file is in the project root and served via HTTP/HTTPS.");
      }
    }

    window.addEventListener('DOMContentLoaded', loadExcel);
  </script>

</body>
</html>
